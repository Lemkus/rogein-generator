# üìê –ê–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `pointGeneration.js` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ –Ω–∞ —Ç—Ä–æ–ø–∞—Ö —Å —É—á–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω, –¥–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
pointGeneration.js
‚îú‚îÄ‚îÄ calculateMinDistance()       - –†–∞—Å—á–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
‚îú‚îÄ‚îÄ calculateMaxAttempts()       - –†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
‚îú‚îÄ‚îÄ generatePoints()             - –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ generatePointsOnPaths()      - –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –Ω–∞ —Ç—Ä–æ–ø–∞—Ö
```

---

## üîß –§—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### `calculateMinDistance(area, count, difficultyLevel)`

–í—ã—á–∏—Å–ª—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–ª–æ—â–∞–¥–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `area` (number) - –ü–ª–æ—â–∞–¥—å –æ–±–ª–∞—Å—Ç–∏ –≤ –º¬≤
- `count` (number) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫
- `difficultyLevel` (number) - –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-3)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `number` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ—Ç—Ä–∞—Ö

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```javascript
function calculateMinDistance(area, count, difficultyLevel) {
  const baseDistance = Math.sqrt(area / count);
  
  switch (parseInt(difficultyLevel)) {
    case 1: // üü¢ –ù–æ–≤–∏—á–æ–∫
      return baseDistance * 0.4;
    case 2: // üü° –õ—é–±–∏—Ç–µ–ª—å
      return baseDistance * 0.8;
    case 3: // üî¥ –≠–∫—Å–ø–µ—Ä—Ç
      return baseDistance * 1.2;
    default:
      return baseDistance * 0.8;
  }
}
```

**–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

–ë–∞–∑–æ–≤–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ `baseDistance = ‚àö(area / count)` –¥–∞—ë—Ç –æ—Ü–µ–Ω–∫—É —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏. –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø–æ–¥–æ–±—Ä–∞–Ω—ã —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏:

- **0.4** - –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–∫–∞–º –±—ã—Ç—å –≤ 2.5 —Ä–∞–∑–∞ –±–ª–∏–∂–µ, —Å–æ–∑–¥–∞–µ—Ç –ø–ª–æ—Ç–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ
- **0.8** - –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
- **1.2** - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ 20%, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–µ—Å–µ–Ω–∏–µ

---

### `calculateMaxAttempts(count, difficultyLevel)`

–í—ã—á–∏—Å–ª—è–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–æ—á–µ–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `count` (number) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫
- `difficultyLevel` (number) - –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-3)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `number` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```javascript
function calculateMaxAttempts(count, difficultyLevel) {
  switch (parseInt(difficultyLevel)) {
    case 1: // üü¢ –ù–æ–≤–∏—á–æ–∫
      return count * 20;
    case 2: // üü° –õ—é–±–∏—Ç–µ–ª—å
      return count * 15;
    case 3: // üî¥ –≠–∫—Å–ø–µ—Ä—Ç
      return count * 30;
    default:
      return count * 15;
  }
}
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:**

- **√ó 20** (–ù–æ–≤–∏—á–æ–∫) - –ú–∞–ª–æ–µ minDist —Ç—Ä–µ–±—É–µ—Ç –º–µ–Ω—å—à–µ –ø–æ–ø—ã—Ç–æ–∫
- **√ó 15** (–õ—é–±–∏—Ç–µ–ª—å) - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
- **√ó 30** (–≠–∫—Å–ø–µ—Ä—Ç) - –ë–æ–ª—å—à–æ–µ minDist —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è

---

## üéØ –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### `generatePoints(selectedBounds, startPoint, count, difficultyLevel, statusCallback, buttonCallback, cancelCallback)`

–ì–ª–∞–≤–Ω–∞—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—á–µ–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `selectedBounds` (Object) - –ì—Ä–∞–Ω–∏—Ü—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
  - `south`, `west`, `north`, `east` (number) - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
  - `type` (string) - 'rectangle' –∏–ª–∏ 'polygon'
  - `polygon` (Object) - Leaflet polygon (–µ—Å–ª–∏ type === 'polygon')
- `startPoint` (Object) - –¢–æ—á–∫–∞ —Å—Ç–∞—Ä—Ç–∞ `{lat, lng}`
- `count` (number) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `difficultyLevel` (number) - –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-3)
- `statusCallback` (Function) - –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- `buttonCallback` (Function) - –§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–æ–π
- `cancelCallback` (Function) - –§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–º–µ–Ω–æ–π

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<void>`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   ```javascript
   if (!selectedBounds || !startPoint || isNaN(count) || count < 1) {
     // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
     return;
   }
   ```

2. **–†–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–∏**
   ```javascript
   let area;
   if (selectedBounds.type === 'polygon') {
     area = calculatePolygonArea(selectedBounds.polygon);
   } else {
     area = rectangleArea(selectedBounds);
   }
   ```

3. **–†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
   ```javascript
   const minDist = calculateMinDistance(area, count, difficultyLevel);
   ```

4. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö OSM**
   ```javascript
   const mapData = await fetchAllMapData(bbox, statusCallback);
   ```

5. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —Ç—Ä–æ–ø**
   ```javascript
   const graph = buildPathGraph(pathsData, [], barriersData);
   const updatedGraph = buildPathGraph(pathsData, forbiddenPolygons, barriersData);
   ```

6. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ç–æ—á–µ–∫**
   ```javascript
   const points = await generatePointsOnPaths(
     pathsData, selectedBounds, startPoint, count, 
     minDist, difficultyLevel, forbiddenPolygons, 
     updatedGraph, startNodeIdx, statusCallback
   );
   ```

7. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI**
   ```javascript
   if (points.length > 0) {
     updateTargetPointsList();
     generateAndDisplaySequence();
   }
   ```

---

## üé≤ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–æ—á–µ–∫

### `generatePointsOnPaths(pathsData, selectedBounds, startPoint, count, minDist, difficultyLevel, forbiddenPolygons, graph, startNodeIdx, statusCallback)`

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–æ—á–µ–∫ –Ω–∞ —Ç—Ä–æ–ø–∞—Ö —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º —Å–Ω–∏–∂–µ–Ω–∏–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è.

**–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª:**

```javascript
let currentMinDist = minDist;
let reductionStep = 0;
let lastPointsCount = 0;

while (points.length < count && attempts < maxAttempts && !cancelGeneration) {
  attempts++;
  
  // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –∑–∞—Å—Ç—Ä—è–ª–∏
  if (attempts % 100 === 0 && points.length === lastPointsCount && reductionStep < 3) {
    reductionStep++;
    currentMinDist = originalMinDist * (1 - reductionStep * 0.15); // -15% –∑–∞ —à–∞–≥
    console.log(`‚ö†Ô∏è –°–Ω–∏–∂–µ–Ω–∏–µ minDist: ${originalMinDist}–º ‚Üí ${currentMinDist}–º`);
  }
  
  // 1. –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–π —Ç—Ä–æ–ø—ã
  const randomPath = filteredPaths[Math.floor(Math.random() * filteredPaths.length)];
  
  // 2. –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–π —Ç–æ—á–∫–∏ –Ω–∞ —Ç—Ä–æ–ø–µ
  const randomPoint = getRandomPointOnLine(linePoints);
  
  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º currentMinDist)
  if (!passesAllChecks(pointObj, currentMinDist)) continue;
  
  // 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏
  points.push(pointObj);
  addPointMarker(pointObj.lat, pointObj.lng, points.length);
}
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫!**

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ—á–∫–∏

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –æ–±–ª–∞—Å—Ç–∏
```javascript
if (pointObj.lat < selectedBounds.south || 
    pointObj.lat > selectedBounds.north ||
    pointObj.lng < selectedBounds.west || 
    pointObj.lng > selectedBounds.east) {
  continue; // –í–Ω–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
}
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏–≥–æ–Ω–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
```javascript
if (selectedBounds.type === 'polygon') {
  if (!pointInPolygon(pointObj.lat, pointObj.lng, polygonCoords)) {
    continue; // –í–Ω–µ –ø–æ–ª–∏–≥–æ–Ω–∞
  }
}
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (—Å jitter)
```javascript
let tooClose = false;
for (const existingPoint of points) {
  const distance = haversine(pointObj.lat, pointObj.lng, existingPoint.lat, existingPoint.lng);
  
  // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É—Ä–æ–≤–Ω—è "–ù–æ–≤–∏—á–æ–∫"
  let effectiveMinDist = minDist;
  if (parseInt(difficultyLevel) === 1) {
    const jitter = 0.7 + Math.random() * 0.6; // 0.7 - 1.3
    effectiveMinDist = minDist * jitter;
  }
  
  if (distance < effectiveMinDist) {
    tooClose = true;
    break;
  }
}
```

**–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** Jitter –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Ä–æ–≤–Ω—è 1, —Å–æ–∑–¥–∞–≤–∞—è **–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**.

#### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω
```javascript
for (const polygon of forbiddenPolygons) {
  if (pointInPolygon(pointObj.lat, pointObj.lng, polygon)) {
    inForbiddenZone = true;
    break;
  }
}
```

#### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç–∏
```javascript
const pointNodeIdx = findNearestNodeIdx(pointObj.lat, pointObj.lng, graph.nodes);
if (pointNodeIdx === -1 || !isReachable(graph, startNodeIdx, pointNodeIdx)) {
  continue; // –ù–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ –æ—Ç —Å—Ç–∞—Ä—Ç–∞
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ª–∞–¥–∫–∏

–ú–æ–¥—É–ª—å —Å–æ–±–∏—Ä–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ø—ã—Ç–æ–∫:

```javascript
const debugStats = {
  totalAttempts: 0,       // –í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫
  invalidPath: 0,         // –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Ç—Ä–æ–ø–∞
  noRandomPoint: 0,       // –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—á–∫—É –Ω–∞ —Ç—Ä–æ–ø–µ
  outOfBounds: 0,         // –í–Ω–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
  outOfPolygon: 0,        // –í–Ω–µ –ø–æ–ª–∏–≥–æ–Ω–∞
  tooClose: 0,            // –°–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –¥—Ä—É–≥–∏–º —Ç–æ—á–∫–∞–º
  inForbiddenZone: 0,     // –í –∑–∞–ø—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω–µ
  noNearestNode: 0,       // –ù–µ –Ω–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —É–∑–µ–ª –≥—Ä–∞—Ñ–∞
  notReachable: 0,        // –ù–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ –æ—Ç —Å—Ç–∞—Ä—Ç–∞
  success: 0              // –£—Å–ø–µ—à–Ω–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ
};
```

–í—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
```
üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—á–µ–∫:
   –í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫: 150
   –°–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ: 87
   –ù–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ: 12
   –£—Å–ø–µ—à–Ω–æ: 10
```

---

## üé® Jitter –∞–ª–≥–æ—Ä–∏—Ç–º (—É—Ä–æ–≤–µ–Ω—å "–ù–æ–≤–∏—á–æ–∫")

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

Jitter –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å –≤ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã —Ç–æ—á–µ–∫, —Å–æ–∑–¥–∞–≤–∞—è **–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```javascript
if (parseInt(difficultyLevel) === 1) {
  const jitter = 0.7 + Math.random() * 0.6; // –î–∏–∞–ø–∞–∑–æ–Ω: 0.7 - 1.3
  effectiveMinDist = minDist * jitter;
}
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```
–ë–µ–∑ jitter (—É—Ä–æ–≤–Ω–∏ 2-3):
  ‚óã     ‚óã     ‚óã     ‚óã     ‚óã
  ‚óã     ‚óã     ‚óã     ‚óã     ‚óã
  ‚óã     ‚óã     ‚óã     ‚óã     ‚óã
  (–†–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è —Å–µ—Ç–∫–∞)

–° jitter (—É—Ä–æ–≤–µ–Ω—å 1):
  ‚óã ‚óã       ‚óã     ‚óã  ‚óã
    ‚óã   ‚óã         ‚óã
  ‚óã       ‚óã ‚óã   ‚óã
  (–ö–ª–∞—Å—Ç–µ—Ä—ã –∏ —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–æ—Å—Ç–∏)
```

### –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ jitter

- **–ú–∏–Ω–∏–º—É–º:** 0.7 ‚Üí —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ = 70% –æ—Ç minDist
- **–ú–∞–∫—Å–∏–º—É–º:** 1.3 ‚Üí —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ = 130% –æ—Ç minDist
- **–°—Ä–µ–¥–Ω–µ–µ:** 1.0 ‚Üí —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ = 100% –æ—Ç minDist

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ** –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ [0.7, 1.3].

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI

### –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–í `app.js`:
```javascript
const difficultyLevelSelect = document.getElementById('difficultyLevel');
const difficultyLevel = difficultyLevelSelect ? 
  parseInt(difficultyLevelSelect.value) : 2;
```

### HTML —ç–ª–µ–º–µ–Ω—Ç

```html
<select id="difficultyLevel" class="settings-input">
  <option value="1">üü¢ –ù–æ–≤–∏—á–æ–∫ (–ø–ª–æ—Ç–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ)</option>
  <option value="2" selected>üü° –õ—é–±–∏—Ç–µ–ª—å (—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)</option>
  <option value="3">üî¥ –≠–∫—Å–ø–µ—Ä—Ç (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–Ω–µ—Å–µ–Ω–∏–µ)</option>
</select>
```

### –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏

```javascript
await generatePoints(
  selectedBounds,
  startPoint,
  count,
  difficultyLevel,  // <-- –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
  updateStatus,
  toggleGenerateButton,
  toggleCancelButton
);
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ú–∞–ª–∞—è –æ–±–ª–∞—Å—Ç—å, –º–Ω–æ–≥–æ —Ç–æ—á–µ–∫ (—Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç)**
   ```
   Area: 0.1 km¬≤
   Points: 20
   Difficulty: 3 (Expert)
   Expected: –ù–µ –≤—Å–µ —Ç–æ—á–∫–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã
   ```

2. **–ë–æ–ª—å—à–∞—è –æ–±–ª–∞—Å—Ç—å, –º–∞–ª–æ —Ç–æ—á–µ–∫ (–ª–µ–≥–∫–∏–π)**
   ```
   Area: 5 km¬≤
   Points: 5
   Difficulty: 1 (Beginner)
   Expected: –í—Å–µ —Ç–æ—á–∫–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –ª–µ–≥–∫–æ
   ```

3. **Jitter –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤–∏–∑—É–∞–ª—å–Ω–∞—è)**
   ```
   Area: 1 km¬≤
   Points: 15
   Difficulty: 1 (Beginner)
   Expected: –í–∏–¥–∏–º—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –∏ —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–æ—Å—Ç–∏
   ```

4. **–ó–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã**
   ```
   Area: 1 km¬≤ —Å –æ–∑–µ—Ä–æ–º –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ
   Points: 10
   Difficulty: 2 (Amateur)
   Expected: –¢–æ—á–∫–∏ –Ω–µ –≤ –æ–∑–µ—Ä–µ, —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –≤–æ–∫—Ä—É–≥
   ```

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- **–£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ:** ‚â• 80% –æ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** < 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è 20 —Ç–æ—á–µ–∫
- **–í–∞–ª–∏–¥–Ω–æ—Å—Ç—å:** 100% —Ç–æ—á–µ–∫ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ–∫—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫**
   ```javascript
   const maxAttempts = calculateMaxAttempts(count, difficultyLevel);
   ```
   –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã.

2. **–†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ**
   ```javascript
   if (cancelGeneration) return;
   ```
   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö.

3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π**
   ```javascript
   // –ò—Å–ø–æ–ª—å–∑—É–µ–º haversine –≤–º–µ—Å—Ç–æ —Ç–æ—á–Ω–æ–π –≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—É–ª—ã
   const distance = haversine(lat1, lng1, lat2, lng2);
   ```

4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–æ–ø**
   ```javascript
   const filteredPaths = pathsData.filter(path => 
     path.geometry && Array.isArray(path.geometry) && path.geometry.length > 0
   );
   ```
   –ï–¥–∏–Ω–æ–∂–¥—ã –≤ –Ω–∞—á–∞–ª–µ.

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **Spatial indexing –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–ª–∏–∑–æ—Å—Ç–∏**
   ```javascript
   // TODO: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å quadtree –∏–ª–∏ R-tree
   // –¥–ª—è O(log n) –≤–º–µ—Å—Ç–æ O(n) –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
   ```

2. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–æ–ø –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é**
   ```javascript
   // TODO: –û—Ç–±—Ä–∞—Å—ã–≤–∞—Ç—å —Ç—Ä–æ–ø—ã, —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–∏–µ –æ—Ç —É–∂–µ —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
   ```

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ minDist**
   ```javascript
   // TODO: –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ç–æ—á–∫–∏, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å–Ω–∏–∂–∞—Ç—å minDist
   ```

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ú–∞–ª—ã–µ –æ–±–ª–∞—Å—Ç–∏**
   - –ü—Ä–∏ area < 0.1 km¬≤ –∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–æ—á–µ–∫ –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∏—Ç—å –º–µ—Å—Ç–∞
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥—Ä–∞—Ñ–∞**
   - –ï—Å–ª–∏ –≥—Ä–∞—Ñ —Ä–∞–∑–±–∏—Ç –Ω–∞ –Ω–µ—Å–≤—è–∑–Ω—ã–µ —á–∞—Å—Ç–∏, —Ç–æ—á–∫–∏ –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–æ—Å—Ç–∏–∂–∏–º–æ–π —á–∞—Å—Ç–∏
   - **–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Ö–æ–¥–∏—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–≤—è–∑–Ω–æ—Å—Ç–∏

3. **Jitter –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–ª–∏—à–∫–æ–º –ø–ª–æ—Ç–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã**
   - –í —Ä–µ–¥–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–µ–∫ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20–º)

---

## üìö –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏
- `utils.js` - haversine, pointInPolygon, getRandomPointOnLine
- `algorithms.js` - buildPathGraph, findNearestNodeIdx, isReachable
- `mapModule.js` - addPointMarker, getStartPoint
- `optimizedOverpassAPI.js` - fetchAllMapData

### –í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- Leaflet (—á–µ—Ä–µ–∑ mapModule) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª–∏–≥–æ–Ω–∞–º–∏

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–µ—Ä—Å–∏—è 2.1 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ minDist –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –ø–æ–ø—ã—Ç–æ–∫
- [ ] Spatial indexing –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
- [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ø—ã—Ç–æ–∫

### –í–µ—Ä—Å–∏—è 2.2
- [ ] –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–≤—è–∑–Ω–æ—Å—Ç–∏
- [ ] Weighted distribution (–±–æ–ª—å—à–µ —Ç–æ—á–µ–∫ –≤ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

### –í–µ—Ä—Å–∏—è 3.0
- [ ] Machine learning –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
- [ ] –£—á–µ—Ç —Ä–µ–ª—å–µ—Ñ–∞ (–Ω–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã)
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ —Ö–æ–¥—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)

---

## üìù Changelog

### v2.0 (26.10.2025)
- ‚ú® –î–æ–±–∞–≤–ª–µ–Ω—ã —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–ù–æ–≤–∏—á–æ–∫, –õ—é–±–∏—Ç–µ–ª—å, –≠–∫—Å–ø–µ—Ä—Ç)
- ‚ú® –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω jitter –¥–ª—è —É—Ä–æ–≤–Ω—è "–ù–æ–≤–∏—á–æ–∫"
- ‚ú® –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞

### v1.0 (–ø—Ä–µ–∂–Ω—è—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç–∏

---

**–ê–≤—Ç–æ—Ä:** TrailSpot Team  
**–î–∞—Ç–∞:** 26 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0

