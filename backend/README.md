# –ë—ç–∫–µ–Ω–¥ –¥–ª—è –†–æ–≥–µ–π–Ω –ù–∞–≤–∏–≥–∞—Ü–∏–∏

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–µ–∫
- **–û–±–º–µ–Ω –º–∞—Ä—à—Ä—É—Ç–∞–º–∏** - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞ —Å –¥—Ä—É–∑—å—è–º–∏
- **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∂–¥–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏
- **–†–µ–π—Ç–∏–Ω–≥–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** - –æ—Ü–µ–Ω–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** - GPX/KML —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.11+** –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd backend
pip install -r requirements.txt
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
```bash
uvicorn app.main:app --host localhost --port 8001 --reload
```

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API:**
- Swagger UI: http://localhost:8001/docs
- ReDoc: http://localhost:8001/redoc

### –í–∞—Ä–∏–∞–Ω—Ç 2: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å Docker Compose:**
```bash
cd backend
docker-compose up -d
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
- API: http://localhost:8001
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8001/docs
- PostgreSQL: localhost:5432
- Redis: localhost:6379

## üìä API Endpoints

### üó∫Ô∏è **–ú–∞—Ä—à—Ä—É—Ç—ã**
- `GET /api/routes` - —Å–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `POST /api/routes` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
- `GET /api/routes/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ ID
- `PUT /api/routes/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
- `DELETE /api/routes/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
- `POST /api/routes/{id}/share` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞
- `GET /api/routes/shared/{token}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ —Å—Å—ã–ª–∫–µ
- `POST /api/routes/{id}/rating` - –æ—Ü–µ–Ω–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞

### üèÉ **–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏**
- `GET /api/training` - –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- `POST /api/training` - –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- `PUT /api/training/{id}` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- `GET /api/training/{id}` - –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- `GET /api/training/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

### üìÅ **–≠–∫—Å–ø–æ—Ä—Ç**
- `GET /api/export/routes/{id}/gpx` - —ç–∫—Å–ø–æ—Ä—Ç –º–∞—Ä—à—Ä—É—Ç–∞ –≤ GPX
- `GET /api/export/routes/{id}/kml` - —ç–∫—Å–ø–æ—Ä—Ç –º–∞—Ä—à—Ä—É—Ç–∞ –≤ KML
- `GET /api/export/training/{id}/gpx` - —ç–∫—Å–ø–æ—Ä—Ç —Ç—Ä–µ–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

### üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (TODO)
- `POST /api/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `POST /api/auth/logout` - –≤—ã—Ö–æ–¥
- `GET /api/auth/me` - —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏:
- **Users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- **Routes** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- **TrainingSessions** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- **RouteRatings** - –æ—Ü–µ–Ω–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- **RouteShares** - —Å—Å—ã–ª–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞

### –°—Ö–µ–º–∞ –ë–î:
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
users (id, username, email, password_hash, created_at)

-- –ú–∞—Ä—à—Ä—É—Ç—ã
routes (id, user_id, title, description, bounds, start_point, points, difficulty, rating, created_at)

-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
training_sessions (id, user_id, route_id, started_at, finished_at, points_visited, navigation_data, gps_track)

-- –û—Ü–µ–Ω–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
route_ratings (id, route_id, user_id, rating, comment, created_at)

-- –û–±–º–µ–Ω –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
route_shares (id, route_id, share_token, expires_at, access_count)
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `app/config.py`:

```python
class Settings:
    # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    DEBUG: bool = True
    HOST: str = "localhost"
    PORT: int = 8001
    
    # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    DATABASE_URL: str = "sqlite+aiosqlite:///./rogaine.db"
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    SECRET_KEY: str = "your-secret-key"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    
    # CORS
    ALLOWED_ORIGINS: list = ["http://localhost:8000"]
```

–î–ª—è production —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
DEBUG=false
DATABASE_URL=postgresql+asyncpg://user:password@localhost/rogaine_db
SECRET_KEY=your-super-secret-key
ALLOWED_ORIGINS=["https://yourdomain.com"]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

**–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞:**
```bash
curl -X POST "http://localhost:8001/api/routes" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –ø–∞—Ä–∫–µ",
    "description": "10 —Ç–æ—á–µ–∫ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–π –ø—Ä–æ–±–µ–∂–∫–∏",
    "bounds": {
      "sw_lat": 60.1,
      "sw_lng": 30.2,
      "ne_lat": 60.12,
      "ne_lng": 30.25
    },
    "start_point": {"lat": 60.11, "lng": 30.22},
    "points": [
      {"lat": 60.111, "lng": 30.221},
      {"lat": 60.112, "lng": 30.222}
    ],
    "difficulty_level": 2
  }'
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤:**
```bash
curl "http://localhost:8001/api/routes?difficulty_min=1&difficulty_max=3&page=1&size=10"
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞:**
```bash
curl -X POST "http://localhost:8001/api/routes/1/share" \
  -H "Content-Type: application/json" \
  -d '{"expires_hours": 24}'
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

–í —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `apiClient.js`:

```javascript
import { saveCurrentRoute, loadRoute, shareCurrentRoute } from './modules/apiClient.js';

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
const savedRoute = await saveCurrentRoute(bounds, startPoint, points, {
    title: "–ú–æ–π –º–∞—Ä—à—Ä—É—Ç",
    difficulty: 2,
    isPublic: true
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞
const route = await loadRoute(savedRoute.id);

// –û–±–º–µ–Ω –º–∞—Ä—à—Ä—É—Ç–æ–º
const shareData = await shareCurrentRoute(savedRoute.id, 48); // 48 —á–∞—Å–æ–≤
console.log('–°—Å—ã–ª–∫–∞ –¥–ª—è –¥—Ä—É–≥–∞:', shareData.full_url);
```

## üöß TODO (–°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã)

1. **JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–≠–∫—Å–ø–æ—Ä—Ç GPX/KML** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –¥–ª—è GPS —É—Å—Ç—Ä–æ–π—Å—Ç–≤
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - Redis –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
5. **–¢–µ—Å—Ç—ã** - unit –∏ integration —Ç–µ—Å—Ç—ã
6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ API –æ–ø–∏—Å–∞–Ω–∏–µ
7. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏
8. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** - Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π

## üêõ –û—Ç–ª–∞–¥–∫–∞

**–ü—Ä–æ–±–ª–µ–º—ã —Å CORS:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ main.py
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–º –¥–æ–º–µ–Ω–µ
```

**–ü—Ä–æ–±–ª–µ–º—ã —Å –ë–î:**
```bash
# –î–ª—è SQLite –ë–î —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# –î–ª—è PostgreSQL —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:
docker-compose up db -d
```

**–õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
```bash
docker-compose logs backend -f
```

---

**–ë—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∏ –Ω–∞—á–Ω–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã! üéØ**
